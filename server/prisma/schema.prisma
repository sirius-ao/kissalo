generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"

}


enum UserRole {
  PROFISIONAL
  COSTUMER
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}


enum ProfisionalType{
  ENTERPRISE
  INDIVIDUAL
}

enum ServicePriceType {
  FIXED
  HOURLY
}


enum ServiceLocation{
  CLIENT_HOME
  PROFISIONAL_HOME
  PROFISIONAL_SPACE
}


enum BookinStatus {
  PENDING
  COMPLETED
  STARTED
  CANCELED
  CONFIRMADED
}

enum PaymentStatus {
  PAID
  PENDING
  REFUNDED

}

enum NotificationType {
  BOOKING
  REVIEW
  SYTEM
  ALERT
  PAYMENT
}

enum NotificationChanel {
  EMAIl
  PUSH
  SMS
}

enum BookingPriority {
  HIGH
  MIDIUM
  LOW
}

enum VerificationsType {
  ACCOUNT_VRIFICATION
  RESET_PASSWORD_REQUEST
}

model User {
  id             Int            @id @default(autoincrement())
  firstName String
  lastName  String
  email     String    @unique
  phone     String       @unique
  profile   String?
  password  String
  isVerified Boolean @default(false)
  isEmailVerified Boolean @default(false)
  tokenToActivate String @unique
  role UserRole @default(COSTUMER)
  status UserStatus @default(ACTIVE)
  stats          Json
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  @@index([email])
  @@index([role])
  @@index([id])

  profisionalData Profisional[]
  notifications Notification[]
  reviews Review[]
  Payments Payments[]
  verifications Verifications[]
  booking Booking[]
  executionsRequests BookingExecution[]
}

model Verifications{
  id             Int            @id @default(autoincrement())
  userId Int @unique
  token String  @unique
  createdAt      DateTime       @default(now())
  type VerificationsType
  updatedAt      DateTime       @updatedAt
  isUsed Boolean @default(false)
  expiresAt DateTime
  metaData Json?
  user User @relation(fields: [userId] , references: [id] ,onDelete: Cascade)
}


model Profisional {
  id             Int            @id @default(autoincrement())
  userId Int
  waletId Int
  type ProfisionalType
  title String?
  description String?
  documentNumber String
  especialities String[]
  certifications String[]
  status UserStatus @default(ACTIVE)
  isVerified Boolean @default(false)
  averageRating Float
  yearsExperience Int
  portfolioUrl String?
  coverUrl String?
  cvUrl String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  stats Json
  contacts Json
  socialMidea Json
  @@index([status])
  @@index([type])
  user User @relation(fields: [userId] , references: [id] ,onDelete: Cascade)
  reviews Review[]
  Payments Payments[]
  booking Booking[]
  wallets Wallet[]
  consolidations Consolidation[]
  executionsRequests BookingExecution[]
}



model Category {
  id             Int            @id @default(autoincrement())
  title String  
  slug String @unique
  description String?
  tags String[]
  color String
  order Int
  featured Boolean @default(true)
  coverUrl String?
  isActive Boolean @default(true)
  stats Json
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  subCategories SubCategory[]
  services Services[]
}


model SubCategory {
  id             Int            @id @default(autoincrement())
  categoryId Int
  title String  
  slug String @unique
  description String?
  tags String[]
  order Int
  stats Json
  isActive Boolean @default(true)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  Category Category @relation(fields: [categoryId] , references: [id] ,onDelete: Cascade)
  services Services[]
}


model Services {
  id             Int            @id @default(autoincrement())
  profissionalId Int
  categoryId Int
  subCategoryId Int?
  title String
  descrition String
  tags String[]
  images String[]
  basePrice Int
  duration Int?
  priceType ServicePriceType
  requeriments String[]
  includes String[]
  notes String[]
  isActive Boolean @default(true)
  stats Json
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@index([profissionalId])
  @@index([categoryId])
  @@index([subCategoryId])
  category Category @relation(fields: [categoryId] , references: [id] ,onDelete: Cascade)
  subCategory SubCategory? @relation(fields: [subCategoryId] , references: [id] ,onDelete: Cascade)
  reviews Review[]
  booking Booking[]

}


model Booking {
  id             Int            @id @default(autoincrement())
  bookingCode String
  clientId Int
  profissionalId Int
  serviceId Int
  scheduleDate DateTime
  startTime DateTime
  endTime DateTime
  duration Int
  adress Json
  location ServiceLocation
  priority BookingPriority
  status BookinStatus @default(PENDING)
  paymentStatus PaymentStatus @default(PENDING)
  totalAmount Int
  cancellationReaseon String?
  clientNotes String?
  profissionalNodes String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  notifications Notification[]
  reviews Review[]
  Payments Payments[]
  client User @relation(fields: [clientId] , references: [id], onDelete: Cascade)
  profissional Profisional @relation(fields: [profissionalId] , references: [id], onDelete: Cascade)
  service Services @relation(fields: [serviceId] , references: [id], onDelete: Cascade)
  executionsRequests BookingExecution[]
  @@index([profissionalId])
  @@index([serviceId])
  @@index([clientId])
}

model BookingExecution {
  id             Int            @id @default(autoincrement())
  profissionalId Int
  clientId Int
  bookingId Int @unique
  optCode Int
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  expiredAt DateTime
  acceptedAt DateTime?
  isAcepted Boolean @default(false)
  isOpen Boolean @default(true)
  client User @relation(fields: [clientId] , references: [id], onDelete: Cascade)
  profissional Profisional @relation(fields: [profissionalId] , references: [id], onDelete: Cascade)
  booking Booking @relation(fields: [bookingId] , references: [id], onDelete: Cascade)

}


model Payments {
  id             Int            @id @default(autoincrement())
  bookingId Int
  clientId Int
  profissionalId Int
  amount Int
  currency String
  comprovativeUrl String?
  iban String
  method String
  status PaymentStatus @default(PENDING) 
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  paidAt DateTime?
  refunedAt DateTime?
  notifications Notification[]
  booking Booking @relation(fields: [bookingId] , references: [id], onDelete: Cascade)
  client User @relation(fields: [clientId] , references: [id], onDelete: Cascade)
  profissional Profisional @relation(fields: [profissionalId] , references: [id], onDelete: Cascade)
  consolidations Consolidation[]
  @@index([profissionalId])
  @@index([bookingId])
  @@index([clientId])
}


model Review {
  id             Int            @id @default(autoincrement())
  bookingId Int
  clientId Int
  profissionalId Int
  serviceId Int
  rating Int
  comment String?
  profisionalReply String?
  repliedAt DateTime?
  isFeatured Boolean @default(true)
  isRead Boolean @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  notifications Notification[]
  booking Booking @relation(fields: [bookingId] , references: [id], onDelete: Cascade)
  client User @relation(fields: [clientId] , references: [id], onDelete: Cascade)
  profissional Profisional @relation(fields: [profissionalId] , references: [id], onDelete: Cascade)
  service Services @relation(fields: [serviceId] , references: [id], onDelete: Cascade)
  @@index([bookingId])
  @@index([clientId])
  @@index([profissionalId])
  @@index([serviceId])
}

model Notification {
  id             Int            @id @default(autoincrement())
  userId Int
  type NotificationType
  title String
  subject String
  deepLink String?
  bookingId Int?
  reviewId Int?
  paymentId Int?
  message String
  isRead Boolean @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  channel NotificationChanel
  review Review? @relation(fields: [reviewId] , references: [id], onDelete: SetNull)
  booking Booking? @relation(fields: [bookingId] , references: [id], onDelete: SetNull)
  payment Payments? @relation(fields: [paymentId] , references: [id], onDelete: SetNull)
  user User @relation(fields: [userId] , references: [id], onDelete: Cascade)
}

model Wallet {
  id             Int            @id @default(autoincrement())
  profissionalId Int
  bankName String
  acountNumber String @unique
  acountHolder String
  isActive Boolean @default(true)
  isVerified Boolean @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  profissional Profisional @relation(fields: [profissionalId] , references: [id], onDelete: Cascade)
  consolidations Consolidation[]
}


model Consolidation {
  id             Int            @id @default(autoincrement())
  profissionalId Int
  paymentId Int
  walletId Int
  commition Int
  totalAmount Int
  totalProfisionalEarnings Int
  notes String?
  sheduledAt DateTime
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  profissional Profisional @relation(fields: [profissionalId] , references: [id], onDelete: Cascade)
  payment Payments @relation(fields: [paymentId] , references: [id], onDelete: Cascade)
  Wallet Wallet @relation(fields: [walletId] , references: [id], onDelete: Cascade)
}